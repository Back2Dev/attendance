var HostedFields=new function(){this.create=function(t){return new e(t)};var e=function(e){function t(e,t,n){n||(n="*"),e.postMessage(JSON.stringify(t),n)}function n(e){window.addEventListener("message",function(t){e(JSON.parse(t.data),t)},!1)}function i(){return S(e),e.sandbox&&(A=e.sandbox),p(function(t){O=t,u(e.fields,e.styles)}),n(function(e){switch(e.type){case"tokenizeResponse":o(e);break;case"validityChange":l(e),r(e);break;case"cardTypeChange":s(e);break;default:a(e)}}),_}function o(e){B["tokenize."+e.requestId]&&B["tokenize."+e.requestId].forEach(function(t){t(e.err,e.response)})}function s(e){var t={type:"cardTypeChange",cardType:e.cardType,timestamp:c()};_.trigger(t)}function r(e){var t={type:"validityChange",field:e.fieldName,isValid:e.valid,timestamp:c()};_.trigger(t)}function a(e){var t={type:e.type,field:e.fieldName,timestamp:c()};_.trigger(t)}function c(){return Number(new Date)}function l(t){var n=t.fieldName,i=t.valid,o=document.querySelector(e.fields[n].selector);i?(f(o,"hosted-fields-valid"),d(o,"hosted-fields-invalid")):(d(o,"hosted-fields-valid"),f(o,"hosted-fields-invalid"))}function f(e,t){e&&(e.className?e.className.includes&&!e.className.includes(t)&&(e.className+=" "+t):e.className=t)}function d(e,t){e&&e.className&&(e.className=e.className.replace(t,"").replace(/^\s|\s$/g,"").replace(/\s\s+/g," "))}function u(e,n){Object.keys(e).forEach(function(i){J[i]=!1,y(e[i].selector,i,e[i],function(e,o){var s={type:"applyStyles",data:n};t(e.contentWindow,s),m(e,o),b(i)})})}function m(e,t){var n;if(t.labelSelector)n=document.querySelectorAll(t.labelSelector);else{var i=t.selector.replace("#","");n=document.querySelectorAll('label[for="'+i+'"]')}n.forEach&&n.forEach(function(t){t.addEventListener("click",function(){e&&e.contentWindow.focus()})})}function p(e){var t=document.createElement("iframe");t.class="pin-control-iframe",t.src=h(),t.style.cssText="display: none;",document.body.appendChild(t),t.addEventListener("load",function(){e(t)})}function h(){return j+"/hosted_fields.html?instance_identifier="+W}function y(e,t,n,i){var o=document.querySelector(e),s=v(t,n);o.appendChild(s),f(o,"pin-form-field"),s.addEventListener("load",function(){var e=document.getElementById(I+t);i(e,n)})}function v(e,t){var n=document.createElement("iframe");return n.id=I+e,n.src=g(e,t),n.frameBorder="0",n.scrolling="no",n.allowTransparency="true",n.style.cssText=L,n}function g(e,t){var n=j+"/field.html?field_name="+e+"&instance_identifier="+W;return t.placeholder&&(n+="&placeholder="+k(t.placeholder)),n}function b(e){J[e]=!0;var t=!0;Object.keys(J).forEach(function(e){J[e]||(t=!1)}),t&&w()}function w(){var e={type:"ready",timestamp:c()};_.trigger(e)}function k(e){return e.replace(/[^\w\/\s@\$]/g,"")}function S(e){T(e,"options must be a hash"),N(e,"fields","options.fields is required"),T(e.fields,"options.fields must be a hash"),E(Object.keys(e.fields),4,"options.fields must contain exactly 4 keys, "+M),M.forEach(function(t){N(e.fields,t,"options.fields must contain key :: "+t),N(e.fields[t],"selector","options.fields."+t+".selector must be present"),q(e.fields[t].selector,"string","options.fields."+t+".selector must a string");var n=document.querySelectorAll(e.fields[t].selector);E(n,1,"Selector for field '"+t+"' matches "+n.length+" elements, must match exactly 1 element"),e.fields[t].labelSelector&&q(e.fields[t].labelSelector,"string","options.fields."+t+".labelSelector must a string")})}function E(e,t,n){if(e.length!==t)throw n}function N(e,t,n){if(!e[t])throw n}function q(e,t,n){if(typeof e!==t)throw n}function T(e,t){if(!e||e.constructor!==Object)throw t}function x(){return z(Math.floor(268435456*(1+Math.random())))+z(C()+65536)}function z(e){return e.toString(16).substring(1)}function C(){return(new Date).getTime()%1e3}var O,_=this,I="pin.",j="https://cdn.pin.net.au/hosted_fields_assets",L="border: none; width: 100%; height: 100%; float: left; overflow: hidden;",A=!1,M=["name","number","cvc","expiry"],W=x(),B={},D=0,J={};_.tokenize=function(e,n){T(e,"Params must be a hash"),q(n,"function","Tokenize callback must be a function");var i={type:"tokenize",params:e,sandbox:A,requestId:++D};B["tokenize."+i.requestId]=[n],t(O.contentWindow,i)},_.on=function(e,t){B[e]||(B[e]=[]),B[e].push(t)},_.trigger=function(e,t){B[e.type]&&B[e.type].forEach(function(n){n(e,t)})},i()}};